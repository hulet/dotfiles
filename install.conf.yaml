# useful commands:
# ./install --only create link
# ./install --only plugins brewfile
# ./install --only shell

- defaults:
    link:
      backup: true
      force: true
      relink: true
    create:
      mode: 0755

- plugins:
    - dotbot-plugins/dotbot-brew/

- create:
    ~/.config:
    ~/.config/bat/themes:
    ~/.config/btop:
    ~/.config/eza:
    ~/.config/ghostty:
    ~/.config/ripgrep:
    ~/.config/zellij:

- clean:
    ~/:
      force: true
    ~/.config:
      force: true

- link:
    # symlink destination: git source
    ~/.bashrc: bashrc
    ~/.config/bat/config: bat.config
    ~/.config/bat/themes/tokyonight_night.tmTheme: bat.tokyonight_night.tmTheme
    ~/.config/btop/btop.conf: btop.conf
    ~/.config/eza/theme.yml: eza.tokyonight.yml
    ~/.config/ghostty/config: ghostty.config
    ~/.config/ghostty/linux.config:
      if: '[ "$(uname)" = "Linux" ]'
      path: ghostty.linux.config
    ~/.config/ghostty/macos.config:
      if: '[ "$(uname)" = "Darwin" ]'
      path: ghostty.macos.config
    ~/.config/nvim: nvim
    ~/.config/ripgrep/ripgrep.conf: ripgrep.conf
    ~/.config/starship.toml: starship.toml
    ~/.config/zellij/config.kdl: zellij.config.kdl
    ~/.gitconfig: gitconfig
    ~/.gitignore: gitignore
    ~/.grep-exclude: grep-exclude
    ~/.screenrc: screenrc
    ~/.vim: vim
    ~/.vimrc: vimrc
    ~/.zimrc: zimrc
    ~/.zshenv: zshenv
    ~/.zshrc: zshrc
    ~/Library/Services/Open\ in\ Ghostty.workflow:
      if: '[ "$(uname)" = "Darwin" ]'
      path: 'Open in Ghostty.workflow'

- brewfile:
    - Brewfile

- shell:
    # install nvim plugins
    # TODO: command will fail if nvim is not in $PATH
    #- nvim --headless -c quitall

    - description: "--> install custom bat themes\n"
      command: |
        bat cache --build > /dev/null

    - description: "--> set up macOS OS config\n"
      command: |
        if [ "$(uname)" = "Darwin" ]; then
          ./osx.sh
        fi

    - description: "--> set up Ghostty launcher on macOS\n"
      command: |
        if [ "$(uname)" = "Darwin" ]; then
          osacompile -o ~/Applications/"Terminal (Ghostty).app" -e 'do shell script "open -a Ghostty"';
        fi

    - description: "-->  remap caps lock to control (GNOME)\n"
      command: |
        if [ "$(uname -s)" = "Linux" ] && command -v gsettings >/dev/null; then
          gsettings set org.gnome.desktop.input-sources xkb-options "['ctrl:nocaps']"
        fi

    - description: "--> Symlinking Homebrew Zsh to /usr/bin for Docker compatibility\n"
      command: |
        BREW_ZSH="/home/linuxbrew/.linuxbrew/bin/zsh"
        # Only run if we are on Linux AND the brew binary exists
        if [ "$(uname -s)" = "Linux" ] && [ -f "$BREW_ZSH" ]; then
          # Check if we have permission to write to /usr/bin (or use sudo)
          if [ -w /usr/bin ]; then
            ln -sf "$BREW_ZSH" /usr/bin/zsh
          elif command -v sudo >/dev/null; then
            sudo ln -sf "$BREW_ZSH" /usr/bin/zsh
          else
            echo "Skipping zsh symlink: No root permissions"
          fi
        fi
